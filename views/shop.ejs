<%- include('./partials/header') %>
    
  <% if (success && success.length > 0) { %>
  <div id="successMessage" class="flash-message bg-green-500 text-white p-3 rounded absolute top-5 left-1/2 -translate-x-1/2 transition-opacity duration-700 ease-in-out">
    <% success.forEach(msg => { %>
      <p><%= msg %></p>
    <% }) %>
  </div>
<% } %>

<% if (error && error.length > 0) { %>
  <div id="errorMessage" class="flash-message bg-red-500 text-white p-3 rounded absolute top-20 left-1/2 -translate-x-1/2 transition-opacity duration-700 ease-in-out">
    <% error.forEach(msg => { %>
      <p><%= msg %></p>
    <% }) %>
  </div>
<% } %>
   
<div class="w-full flex justify-center py-5">
  <form action="/shop" method="GET" class="w-1/2 flex">
    <input 
      type="text" 
      name="search" 
      placeholder="Search products..." 
      value="<%= typeof search !== 'undefined' ? search : '' %>"
      class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
    />
    <button 
      type="submit" 
      class="bg-gradient-to-r from-orange-400 to-red-500 px-4 py-2 text-white font-semibold rounded-r-md hover:bg-yellow-600 transition">
      Search
    </button>
  </form>
</div>

<div class="w-full min-h-screen flex items-start px-20 py-20">
        <div class="w-[25%] flex h-full flex-col items-start">

           <div class="flex items-center gap-3 mb-4">
              <h3 class="text-lg font-medium ">Sort by:</h3>
                <form action="/shop" method="GET" class="relative">
    <!-- Retain existing filter in query when changing sort -->
                  <input type="hidden" name="filter" value="<%= filter || '' %>">
                     <select name="sortby"
                     class="border border-gray-300 text-gray-700 bg-white rounded-md shadow-sm px-2 py-2 pr-6 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out"
                     onchange="this.form.submit()">
      <option value="popular" <%= sortby === 'popular' ? 'selected' : '' %>>Popular</option>
      <option value="newest" <%= sortby === 'newest' ? 'selected' : '' %>>Newest</option>
    </select>
  </form>
</div>

            <div class="flex flex-col mt-20">
              <!-- <a class="block w-fit mb-2 <%= filter === 'new' ? 'underline' : '' %>" href="/shop?filter=new">New Collection</a> -->
                <a class="block w-fit mb-2 <%= filter === 'new' ? 'underline' : '' %>" href="/shop">All Products</a>
                <a class="block w-fit mb-2 <%= filter === 'discount' ? 'underline' : '' %>" href="/shop?filter=discount">Discounted Products</a>
            </div>
            <div class="mt-32">
                <a class="block w-fit mb-2 font-bold text-lg" >Filter by :</a>
                <a class="block w-fit mb-2 <%= filter === 'availability' ? 'underline' : '' %>" href="/shop?filter=availability">Availability</a>
                <a class="block w-fit mb-2 <%= filter === 'discount1' ? 'underline' : '' %>" href="/shop?filter=discount1">Discount</a>
            </div>
        </div>

        <div class="w-[75%] flex flex-wrap gap-5 h-full">
            <% products.forEach(function(product){ %>
                <div class="w-60 mb-3 hover:scale-110 transition-transform duration-200">
                    <div class="w-full h-52 bg-[<%=product.bgcolor %>]">
                        <% if (product.image  && product.image.length) { %>
                            <a href="/product/<%= product._id %>">
                            <img class="w-full h-full object-contain"
                                src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="">
                            <% } else { %>
                                <div
                                    class="w-full h-full flex items-center justify-center text-white bg-gray-400 text-lg font-semibold">
                                    No Image
                                </div>
                             </a>
                                <% } %>
                    </div>

                    <div class="flex justify-between bg-[<%= product.panelcolor%>] items-center px-4 py-4 text-[<%= product.textcolor%>] shadow">
                        <div>
                            <h3 class="font-semibold">
  <%= product.name %>
</h3>
<h4>â‚¹ <%= product.price %></h4>

<% if (parseInt(product.inStock) == 0) { %>
  <p class="text-red-600 text-sm font-medium">Out of Stock! </p> 
<% } else if (parseInt(product.inStock) <= 5) { %>
  <p class="text-red-600 text-sm font-medium">Only <%= product.inStock %> left!</p>
<% } %>   
                        </div>
                        <a class="w-7 h-7 flex items-center justify-center rounded-full bg-white border" href="/addtocart/<%= product._id %>">
                            <i class="text-gray-800 ri-add-line"></i>
                        </a>
                    </div>
                </div>
                <% }) %>
        </div>
    </div>
    
    <%- include('./partials/footer') %>