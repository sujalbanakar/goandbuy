<%- include('./partials/header') %>

<div class="w-full min-h-screen px-20 py-20">
  <div class="flex flex-wrap gap-6">
    <% for(let i = 0; i < user.cart.length; i++) { 
         var product = user.cart[i].product;
     if (!product) continue; 
%>
      <div class="w-[32%] bg-white rounded-md shadow-md overflow-hidden">
        <!-- Product Image -->
        <div class="w-full h-64 bg-[<%= user.cart[i].bgcolor %>] flex items-center justify-center">
          
          <% const imageBuffer = user.cart[i].product?.image;
          let base64Image = '';
          if (imageBuffer) {
            base64Image = imageBuffer.toString('base64');
          }
          %>
          <img class="w-full h-full object-contain"
               src="data:image/jpeg;base64,<%= base64Image %>" alt="">
        </div>

        <!-- Product Info -->
        <div class="px-5 py-4 text-black">
          <div class="flex justify-between items-center mb-3 ">
            <h3 class="text-xl font-semibold"><%= user.cart[i].product.name %></h3>
            <div class="flex items-center gap-2 ">
              <a class="w-7 h-7 bg-gray-200 flex rounded-full items-center justify-center " href="/increase/<%= user.cart[i].product._id %>">
              <i class="text-gray-800 ri-add-line"></i>
              </a>
              <div class="px-2 py-1 rounded bg-gray-100 text-black"><%= user.cart[i].quantity %></div>
             <a class="w-7 h-7 bg-gray-200 flex rounded-full items-center justify-center" href="/decrease/<%= user.cart[i].product._id %>">
              <i class="text-gray-800 ri-subtract-line"></i>
              </a>
            </div>
          </div>

          <!-- Price Breakdown -->
          <div class="text-sm mb-2">
            <div class="flex justify-between"><span>Total MRP:</span> <span>₹ <%= Number(user.cart[i].product.price) %></span></div>
            <div class="flex justify-between"><span>Discount:</span> <span>- ₹ <%= Number(user.cart[i].product.discount) %></span></div>
          </div>
          <hr class="my-2">   
          <div class="flex justify-between font-semibold text-green-600">
            <span>Total:</span>
            <span>₹ <%= (Number(user.cart[i].product.price) - Number(user.cart[i].product.discount)) * user.cart[i].quantity; %></span>
          </div>
        </div>
      </div>
      <% } %>
    </div>
   <% if(user.cart.length){ %>
    <div class="mt-10">
      <div class="flex justify-between text-2xl"><span>Shipping Fee:</span><span> FREE</span></div>
      <div class="flex justify-between text-2xl"><span>Platform Fee:</span><span> + ₹ 20</span></div>
      <hr class="border-gray-800 my-2 ">   
      <div class="flex justify-between text-3xl font-semibold text-green-600">
        <span>Total:</span>
        <span>₹ <%= bill %></span>
      </div>
    <div class="flex justify-center">
    <a class="rounded-3xl bg-yellow-500 text-2xl px-20 py-2" href="/payment/user">
      Proceed to Buy
    </a>
  </div>
  <% } else { %>
     <div class="text-center py-20">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Your cart is empty</h2>
    <p class="text-gray-500 mb-6">Looks like you haven’t added anything to your cart yet.</p>
    <a href="/shop" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-md transition">
      Continue Shopping
    </a>
  </div>
  <% } %>
  
</div>
</div>
<%- include('./partials/footer') %>
